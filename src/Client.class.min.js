var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},is_nodejs=Eureca.Util.isNodejs,_eureca_prefix,EurecaSocket,Eureca,EURECA;is_nodejs&&(_eureca_prefix="eureca.io"),EurecaSocket=function(n,t){return is_nodejs?require("engine.io-client")(n,t):new eio.Socket(n,t)},function(n){var t=function(t){function i(i){typeof i=="undefined"&&(i={}),t.call(this),this.settings=i,this.tries=0,this.stub=new n.Stub(i),i.transport=i.transport||"engine.io",console.log("* using "+i.transport),this.transport=n.Transport.get(i.transport);var r=this;this.exports={},this.settings.autoConnect=!(this.settings.autoConnect===!1),this.maxRetries=i.retry||20,this.registerEvents(["ready","onConnect","onDisconnect","onError","onMessage","onConnectionLost","onConnectionRetry"]),this.settings.autoConnect&&this.connect()}return __extends(i,t),i.prototype.disconnect=function(){this.tries=this.maxRetries+1,this.socket.close()},i.prototype.connect=function(){var n=this,i="",r,u,t;i+=this.settings.prefix||_eureca_prefix,r=r||undefined,u=this.settings.uri||(i?_eureca_host+"/"+i:r||undefined),console.log(u,i),n._ready=!1,t=this.transport.createClient(u,{prefix:i}),n.socket=t;t.onopen(function(){n.trigger("onConnect",t),n.tries=0});t.onmessage(function(t){var i;n.trigger("onMessage",t);try{i=JSON.parse(t)}catch(r){i={}}if(i.__eureca__){n.contract=i.__eureca__,n.stub.importRemoteFunction(n,n.socket,i.__eureca__),n._ready=!0,n.trigger("ready",n);return}if(i.f!==undefined){n.stub.invoke(n.exports,n,i,n.socket);return}if(i._r!==undefined){n.stub.doCallBack(i._r,i.r);return}});t.ondisconnect(function(){if(n.trigger("onConnectionRetry"),n.tries++,n.tries>n.maxRetries){n.trigger("onConnectionLost");return}var t=n.tries;setTimeout(function(){n.connect()},t*1e3)});t.onclose(function(i){n.trigger("onDisconnect",t,i)});t.onerror(function(t){n.trigger("onError",t)})},i}(n.EObject);n.Client=t}(Eureca||(Eureca={})),is_nodejs?exports.Eureca=Eureca:EURECA=Eureca.Client